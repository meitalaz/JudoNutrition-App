{% extends "base.html" %}

{% block title %}注拽 砖拽 住驻专 - {{ app_name }}{% endblock %}

{% block content %}
<!-- 驻转专  拽转 - 住专 专住 住驻转 -->
<button onclick="window.location.href='/'" style="position: absolute; top: 10px; left: 10px; padding: 6px 10px; background: rgba(0,0,0,0.1); border: none; border-radius: 4px; font-size: 12px; cursor: pointer; z-index: 1000;">
    И 拽
</button>

<div class="container-fluid">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-md-8">
            <h1 class="h3 fw-bold">
                <i class="fas fa-chart-line me-2"></i>
                注拽 砖拽 住驻专
            </h1>
            <p class="text-muted">转 转拽 注拽 专 砖拽  住驻专</p>
        </div>
        <div class="col-md-4 text-md-end">
            <div class="btn-group">
                <button class="btn btn-outline-primary" id="viewModeGrid">
                    <i class="fas fa-th me-2"></i>
                    转爪转 专砖转
                </button>
                <button class="btn btn-primary" id="viewModeList">
                    <i class="fas fa-list me-2"></i>
                    专砖
                </button>
            </div>
        </div>
    </div>

    <!-- Alerts and Filters -->
    <div class="row mb-4">
        <div class="col-md-8">
            <!-- Weight Alerts -->
            <div class="card border-left-warning mb-3">
                <div class="card-header bg-warning text-dark">
                    <h6 class="mb-0">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        转专转 砖拽
                    </h6>
                </div>
                <div class="card-body p-0">
                    <div class="alert-item p-3 border-bottom">
                        <div class="row align-items-center">
                            <div class="col-md-2">
                                <span class="badge bg-danger">祝</span>
                            </div>
                            <div class="col-md-6">
                                <strong> </strong> - 专  砖拽: 1.8 拽"  
                            </div>
                            <div class="col-md-2 text-muted small">
                                 08:30
                            </div>
                            <div class="col-md-2 text-end">
                                <button class="btn btn-sm btn-outline-primary">驻专</button>
                            </div>
                        </div>
                    </div>
                    <div class="alert-item p-3 border-bottom">
                        <div class="row align-items-center">
                            <div class="col-md-2">
                                <span class="badge bg-warning">专转</span>
                            </div>
                            <div class="col-md-6">
                                <strong>砖专 </strong> -   砖拽 3 
                            </div>
                            <div class="col-md-2 text-muted small">
                                驻 
                            </div>
                            <div class="col-md-2 text-end">
                                <button class="btn btn-sm btn-outline-secondary">爪专 拽砖专</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <!-- Filters -->
            <div class="card">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="fas fa-filter me-2"></i>
                        住
                    </h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">住住</label>
                        <select class="form-select form-select-sm">
                            <option value=""> 住驻专</option>
                            <option value="on-track">住</option>
                            <option value="needs-attention">爪专 转砖转 </option>
                            <option value="critical">爪 拽专</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">拽专转 砖拽</label>
                        <select class="form-select form-select-sm">
                            <option value=""> 拽专转</option>
                            <option value="60">60 拽"</option>
                            <option value="66">66 拽"</option>
                            <option value="73">73 拽"</option>
                            <option value="81">81 拽"</option>
                            <option value="90">90 拽"</option>
                            <option value="100">100 拽"</option>
                            <option value="+100">注 100 拽"</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">转拽驻</label>
                        <select class="form-select form-select-sm" id="periodFilter">
                            <option value="7">7  专</option>
                            <option value="14" selected>14  专</option>
                            <option value="30">30  专</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Athletes Weight Analysis -->
    <div class="row">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h6 class="mb-0">注拽 砖拽 住驻专</h6>
                    <div class="btn-group btn-group-sm">
                        <button class="btn btn-outline-secondary">
                            <i class="fas fa-download me-1"></i>
                            爪
                        </button>
                        <button class="btn btn-outline-primary">
                            <i class="fas fa-print me-1"></i>
                            驻住
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Athletes List -->
                    <div id="athletesWeightList">
                        <!-- Athlete 1 -->
                        <div class="athlete-weight-card mb-4">
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="athlete-info">
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="fas fa-user-circle fa-2x text-primary me-2"></i>
                                            <div>
                                                <h6 class="mb-0"> </h6>
                                                <small class="text-muted">拽专: 66 拽"</small>
                                            </div>
                                        </div>
                                        <div class="current-stats">
                                            <div class="stat-item">
                                                <span class="stat-label">砖拽 :</span>
                                                <span class="stat-value text-primary fw-bold">68.2 拽"</span>
                                            </div>
                                            <div class="stat-item">
                                                <span class="stat-label">注:</span>
                                                <span class="stat-value">66.0 拽"</span>
                                            </div>
                                            <div class="stat-item">
                                                <span class="stat-label">转专:</span>
                                                <span class="stat-value text-warning">-2.2 拽"</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="weight-chart-container">
                                        <canvas id="nutritionistChart1" height="150"></canvas>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="athlete-status">
                                        <div class="status-badge bg-warning text-dark mb-2">
                                            <i class="fas fa-exclamation-triangle me-1"></i>
                                            爪专 转砖转 
                                        </div>
                                        <div class="trend-indicator mb-2">
                                            <i class="fas fa-arrow-down text-success me-1"></i>
                                            <span class="small">转 专</span>
                                        </div>
                                        <div class="last-update">
                                            <small class="text-muted">
                                                <i class="fas fa-clock me-1"></i>
                                                注:  08:30
                                            </small>
                                        </div>
                                        <div class="action-buttons mt-3">
                                            <button class="btn btn-sm btn-outline-primary mb-1 w-100">
                                                <i class="fas fa-eye me-1"></i>
                                                驻专 
                                            </button>
                                            <button class="btn btn-sm btn-outline-info w-100">
                                                <i class="fas fa-comments me-1"></i>
                                                砖 注
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Athlete 2 -->
                        <div class="athlete-weight-card mb-4">
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="athlete-info">
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="fas fa-user-circle fa-2x text-primary me-2"></i>
                                            <div>
                                                <h6 class="mb-0">砖专 </h6>
                                                <small class="text-muted">拽专: 57 拽"</small>
                                            </div>
                                        </div>
                                        <div class="current-stats">
                                            <div class="stat-item">
                                                <span class="stat-label">砖拽 :</span>
                                                <span class="stat-value text-primary fw-bold">58.8 拽"</span>
                                            </div>
                                            <div class="stat-item">
                                                <span class="stat-label">注:</span>
                                                <span class="stat-value">57.0 拽"</span>
                                            </div>
                                            <div class="stat-item">
                                                <span class="stat-label">转专:</span>
                                                <span class="stat-value text-success">-1.8 拽"</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="weight-chart-container">
                                        <canvas id="nutritionistChart2" height="150"></canvas>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="athlete-status">
                                        <div class="status-badge bg-success text-white mb-2">
                                            <i class="fas fa-check-circle me-1"></i>
                                            住 爪
                                        </div>
                                        <div class="trend-indicator mb-2">
                                            <i class="fas fa-arrow-down text-success me-1"></i>
                                            <span class="small">专 爪</span>
                                        </div>
                                        <div class="last-update">
                                            <small class="text-muted">
                                                <i class="fas fa-clock me-1"></i>
                                                注: 转 07:45
                                            </small>
                                        </div>
                                        <div class="action-buttons mt-3">
                                            <button class="btn btn-sm btn-outline-primary mb-1 w-100">
                                                <i class="fas fa-eye me-1"></i>
                                                驻专 
                                            </button>
                                            <button class="btn btn-sm btn-outline-success w-100">
                                                <i class="fas fa-thumbs-up me-1"></i>
                                                砖 注
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Athlete 3 -->
                        <div class="athlete-weight-card mb-4">
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="athlete-info">
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="fas fa-user-circle fa-2x text-primary me-2"></i>
                                            <div>
                                                <h6 class="mb-0"> 专</h6>
                                                <small class="text-muted">拽专: 63 拽"</small>
                                            </div>
                                        </div>
                                        <div class="current-stats">
                                            <div class="stat-item">
                                                <span class="stat-label">砖拽 :</span>
                                                <span class="stat-value text-primary fw-bold">64.1 拽"</span>
                                            </div>
                                            <div class="stat-item">
                                                <span class="stat-label">注:</span>
                                                <span class="stat-value">63.0 拽"</span>
                                            </div>
                                            <div class="stat-item">
                                                <span class="stat-label">转专:</span>
                                                <span class="stat-value text-info">-1.1 拽"</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="weight-chart-container">
                                        <canvas id="nutritionistChart3" height="150"></canvas>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="athlete-status">
                                        <div class="status-badge bg-success text-white mb-2">
                                            <i class="fas fa-check-circle me-1"></i>
                                            住 
                                        </div>
                                        <div class="trend-indicator mb-2">
                                            <i class="fas fa-arrow-down text-success me-1"></i>
                                            <span class="small">转拽转 </span>
                                        </div>
                                        <div class="last-update">
                                            <small class="text-muted">
                                                <i class="fas fa-clock me-1"></i>
                                                注:  07:15
                                            </small>
                                        </div>
                                        <div class="action-buttons mt-3">
                                            <button class="btn btn-sm btn-outline-primary mb-1 w-100">
                                                <i class="fas fa-eye me-1"></i>
                                                驻专 
                                            </button>
                                            <button class="btn btn-sm btn-outline-info w-100">
                                                <i class="fas fa-comments me-1"></i>
                                                砖 注
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Nutritionist Weight Analysis
document.addEventListener('DOMContentLoaded', function() {
    initializeNutritionistWeightAnalysis();
});

function initializeNutritionistWeightAnalysis() {
    console.log('Nutritionist weight analysis initialized');
    createNutritionistCharts();
    setupFilterHandlers();
}

function createNutritionistCharts() {
    // Chart for Athlete 1 (Danny Cohen)
    createMiniChart('nutritionistChart1', generateAthleteData(70.5, 68.2, 14));
    
    // Chart for Athlete 2 (Sarah Levy)
    createMiniChart('nutritionistChart2', generateAthleteData(61.2, 58.8, 14));
    
    // Chart for Athlete 3 (Michal Green)
    createMiniChart('nutritionistChart3', generateAthleteData(66.8, 64.1, 14));
}

function createMiniChart(canvasId, data) {
    const ctx = document.getElementById(canvasId);
    if (!ctx) return;
    
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: data.labels,
            datasets: [{
                label: '砖拽',
                data: data.weights,
                borderColor: '#0077C8',
                backgroundColor: 'rgba(0, 119, 200, 0.1)',
                tension: 0.4,
                fill: true,
                pointRadius: 2,
                pointHoverRadius: 4,
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                x: {
                    display: false
                },
                y: {
                    display: false,
                    beginAtZero: false
                }
            },
            interaction: {
                intersect: false,
                mode: 'index'
            }
        }
    });
}

function generateAthleteData(startWeight, endWeight, days) {
    const labels = [];
    const weights = [];
    const weightDiff = (endWeight - startWeight) / (days - 1);
    
    for (let i = 0; i < days; i++) {
        const date = new Date();
        date.setDate(date.getDate() - (days - 1 - i));
        labels.push(date.toLocaleDateString('he-IL', { month: 'short', day: 'numeric' }));
        
        const weight = startWeight + (weightDiff * i) + (Math.random() - 0.5) * 0.4;
        weights.push(Math.round(weight * 10) / 10);
    }
    
    return { labels, weights };
}

function setupFilterHandlers() {
    document.getElementById('periodFilter').addEventListener('change', function() {
        const days = parseInt(this.value);
        // Recreate charts with new period
        createNutritionistCharts();
    });
    
    // View mode toggles
    document.getElementById('viewModeList').addEventListener('click', function() {
        this.classList.add('btn-primary');
        this.classList.remove('btn-outline-primary');
        document.getElementById('viewModeGrid').classList.add('btn-outline-primary');
        document.getElementById('viewModeGrid').classList.remove('btn-primary');
    });
    
    document.getElementById('viewModeGrid').addEventListener('click', function() {
        this.classList.add('btn-primary');
        this.classList.remove('btn-outline-primary');
        document.getElementById('viewModeList').classList.add('btn-outline-primary');
        document.getElementById('viewModeList').classList.remove('btn-primary');
    });
}
</script>

<style>
.athlete-weight-card {
    border: 1px solid #e3e6f0;
    border-radius: 8px;
    padding: 1.5rem;
    transition: all 0.3s ease;
    background: white;
}

.athlete-weight-card:hover {
    border-color: var(--primary-color);
    box-shadow: 0 4px 8px rgba(15, 76, 129, 0.1);
}

.athlete-info .stat-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.5rem;
}

.stat-label {
    font-size: 0.85rem;
    color: #6b7280;
}

.stat-value {
    font-size: 0.9rem;
    font-weight: 500;
}

.weight-chart-container {
    height: 150px;
    position: relative;
}

.status-badge {
    display: inline-flex;
    align-items: center;
    padding: 0.5rem 0.75rem;
    border-radius: 6px;
    font-size: 0.8rem;
    font-weight: 500;
}

.trend-indicator {
    display: flex;
    align-items: center;
    font-size: 0.85rem;
}

.border-left-warning {
    border-left: 4px solid #FFC20E !important;
}

.alert-item:hover {
    background-color: rgba(255, 194, 14, 0.05);
}
</style>
{% endblock %}